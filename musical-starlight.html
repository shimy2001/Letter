
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musical Starlight Message</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
    /* Base Reset & Accessibility */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary-gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        --text-gradient: linear-gradient(45deg, #ff9a9e, #fad0c4, #fbc2eb, #a6c1ee);
        --moon-gradient: radial-gradient(circle at 30% 30%, #f9f3d5, #e8d36c);
        --key-white: linear-gradient(to bottom, #fff, #eee);
        --key-black: linear-gradient(to bottom, #333, #000);
        --key-active: linear-gradient(to bottom, #ff9a9e, #fad0c4);
        --key-black-active: linear-gradient(to bottom, #8a2be2, #4b0082);
        --letter-bg: linear-gradient(to bottom, #fffaf0, #f9e8c8);
    }

    body {
        font-family: 'Quicksand', sans-serif;
        background: var(--primary-gradient);
        min-height: 100vh;
        min-height: 100dvh;
        overflow-x: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        perspective: 1000px;
        -webkit-tap-highlight-color: transparent;
    }

    /* Night Sky & Stars */
    .night-sky {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
    }

    .star {
        position: absolute;
        background-color: #fff;
        border-radius: 50%;
        animation: twinkle var(--duration) infinite ease-in-out;
        animation-delay: var(--delay);
        will-change: opacity;
    }

    @keyframes twinkle {
        0%, 100% { opacity: 0.2; }
        50% { opacity: 1; }
    }

    /* Main Container */
    .container {
        text-align: center;
        width: 90%;
        max-width: 800px;
        padding: 20px;
        position: relative;
        margin: 0 auto;
    }

    /* Moon Element */
    .moon {
        width: clamp(80px, 25vw, 120px);
        height: clamp(80px, 25vw, 120px);
        background: var(--moon-gradient);
        border-radius: 50%;
        margin: 0 auto 30px;
        box-shadow: 0 0 40px rgba(248, 237, 148, 0.6);
        cursor: pointer;
        transition: transform 0.5s ease;
        position: relative;
        overflow: hidden;
        animation: glow 2s infinite ease-in-out;
        touch-action: manipulation;
    }

    .moon:focus-visible {
        outline: 2px solid white;
        outline-offset: 4px;
    }

    .moon:hover, .moon:focus {
        transform: scale(1.05) rotate(10deg);
        animation: heartbeat 1.2s ease-in-out infinite;
        box-shadow: 0 0 60px rgba(248, 237, 148, 0.8);
    }

    @keyframes heartbeat {
        0%, 100% { transform: scale(1); }
        30% { transform: scale(1.1); }
        50% { transform: scale(1.05); }
        70% { transform: scale(1.1); }
    }

    .moon-craters {
        position: absolute;
        width: 100%;
        height: 100%;
    }

    .crater {
        position: absolute;
        background: rgba(203, 185, 108, 0.6);
        border-radius: 50%;
        box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.3);
    }

    /* Typography */
    h1 {
        font-family: 'Pacifico', cursive;
        font-size: clamp(2rem, 8vw, 3rem);
        margin-bottom: 20px;
        background: var(--text-gradient);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        animation: gradient 8s ease infinite;
        line-height: 1.2;
    }

    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .instructions {
        font-size: clamp(1rem, 4vw, 1.2rem);
        margin-bottom: 30px;
        opacity: 0.8;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }

    .header-content {
        transition: all 0.5s ease;
        text-align: center;
    }

    /* Piano Styles */
    .piano-container {
        display: none;
        position: relative;
        opacity: 0;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: clamp(15px, 3vw, 30px);
        margin-top: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform-style: preserve-3d;
        transform: translateY(20px);
        transition: all 0.5s ease;
        width: 100%;
    }

    .piano-container.active {
        opacity: 1;
        display: block;
        transform: translateY(0);
    }

    .piano-title {
        font-size: clamp(1.5rem, 6vw, 1.8rem);
        margin-bottom: 20px;
        color: #fbc2eb;
    }

    .piano-hint {
        font-size: clamp(0.9rem, 3.5vw, 1.1rem);
        margin-bottom: 30px;
        font-style: italic;
    }

    .piano {
        display: flex;
        justify-content: center;
        margin: 0 auto;
        position: relative;
        height: clamp(120px, 30vw, 180px);
        margin-bottom: 30px;
        touch-action: manipulation;
        overflow-x: auto;
        padding-bottom: 10px;
        -webkit-overflow-scrolling: touch;
    }

    .piano::-webkit-scrollbar {
        height: 6px;
    }

    .piano::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.3);
        border-radius: 3px;
    }

    .key {
        position: relative;
        height: clamp(120px, 30vw, 180px);
        width: clamp(34px, 8vw, 70px);
        border: 1px solid #333;
        border-radius: 0 0 8px 8px;
        background: var(--key-white);
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        padding-bottom: 10px;
        font-weight: bold;
        color: #333;
        user-select: none;
        transition: all 0.1s ease;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        z-index: 1;
        font-size: clamp(0.7rem, 2.5vw, 1rem);
        flex-shrink: 0;
    }

    .key:focus-visible {
        outline: 2px solid white;
        outline-offset: 2px;
    }

    .key.black {
        height: clamp(70px, 20vw, 110px);
        width: clamp(16px, 5vw, 30px);
        background: var(--key-black);
        color: white;
        margin-left: calc(clamp(16px, 5vw, 30px) / -2);
        margin-right: calc(clamp(16px, 5vw, 30px) / -2);
        z-index: 2;
        border-radius: 0 0 5px 5px;
    }

    .key.active {
        background: var(--key-active);
        transform: translateY(2px);
        box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }

    .key.active::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 100%;
        background: linear-gradient(to top, 
            rgba(255, 154, 158, 0.8) 0%, 
            transparent 100%);
        animation: key-glow 0.8s ease-out;
    }

    @keyframes key-glow {
        100% { opacity: 0; transform: translateY(-20px); }
    }

    .key.black.active {
        background: var(--key-black-active);
    }

    .song-display {
        font-size: clamp(1rem, 4vw, 1.2rem);
        margin-bottom: 20px;
        min-height: 30px;
        word-break: break-word;
    }

    .feedback {
        min-height: 50px;
        font-size: clamp(1rem, 4vw, 1.2rem);
        margin-top: 20px;
        opacity: 0;
        transition: opacity 0.5s ease;
    }

    .feedback.show {
        opacity: 1;
    }

    .correct-message {
        font-size: clamp(1.2rem, 5vw, 1.5rem);
        color: #ff9a9e;
        margin-top: 30px;
        opacity: 0;
        transition: opacity 1s ease;
        font-weight: bold;
    }

    .correct-message.show {
        opacity: 1;
    }

    /* Letter Styles */
    .letter-container {
        display: none;
        background: 
            radial-gradient(circle at 20% 30%, 
                rgba(138, 43, 226, 0.2) 0%, 
                transparent 40%),
            radial-gradient(circle at 80% 70%, 
                rgba(0, 191, 255, 0.2) 0%, 
                transparent 40%),
            rgba(0, 0, 0, 0.8);
        animation: aurora-shift 20s infinite alternate;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.5s ease;
        overflow: hidden;
        touch-action: pan-y;
    }

    @keyframes aurora-shift {
        0% { background-position: 0% 50%; }
        100% { background-position: 100% 50%; }
    }

    .letter-container.show {
        opacity: 1;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .letter {
        display: block;
        background: var(--letter-bg);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: scale(0);
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        padding: clamp(15px, 5vw, 40px);
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        z-index: 2;
        transition: transform 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        border-radius: 15px;
        overflow-y: auto;
        overflow-x: hidden;
        border: 5px solid #d4af37;
        font-size: clamp(1rem, 3.5vw, 1.1em);
        line-height: 1.6;
        box-sizing: border-box;
        -webkit-overflow-scrolling: touch;
    }

    .letter-container.show .letter {
        transform: translate(-50%, -50%) scale(1);
    }

    .letter p {
        color: #3a1c1a;
        text-align: justify;
        margin-bottom: 15px;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
    }

    .letter p:first-child {
        font-family: 'Dancing Script', cursive;
        font-size: clamp(1.5em, 6vw, 1.8em);
        text-align: center;
        font-weight: bold;
        color: #8b0000;
        margin-bottom: 30px;
    }

    .letter p:last-child {
        font-style: italic;
        text-align: right;
        font-weight: bold;
        color: #7b4b3a;
        margin-top: 30px;
    }

    .letter span {
        color: #b22222;
        font-weight: bold;
    }

    .letter::-webkit-scrollbar {
        width: 8px;
    }

    .letter::-webkit-scrollbar-thumb {
        background: #d4af37;
        border-radius: 10px;
    }

    .wax-seal {
        width: clamp(50px, 15vw, 80px);
        height: clamp(50px, 15vw, 80px);
        background: radial-gradient(circle at center, #a52a2a, #8b0000);
        position: absolute;
        top: 0;
        right: -30px;
        transform: translateX(-50%);
        border-radius: 50%;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(1rem, 5vw, 1.25rem);
        font-weight: bold;
        color: gold;
        font-family: 'Dancing Script', cursive;
        z-index: 10;
        cursor: pointer;
        touch-action: manipulation;
    }

    .wax-seal:active {
        transform: translateX(-50%) scale(0.9);
        transition: transform 0.1s ease;
    }

    /* Buttons */
    .hint-button {
        display: none;
        background: linear-gradient(45deg, #ff9a9e, #fbc2eb);
        border: none;
        border-radius: 50px;
        padding: 12px 24px;
        font-size: clamp(0.9rem, 3.5vw, 1rem);
        color: white;
        cursor: pointer;
        margin: 20px 0;
        box-shadow: 0 4px 15px rgba(251, 194, 235, 0.4);
        transition: all 0.3s ease;
        font-family: 'Quicksand', sans-serif;
        font-weight: bold;
        position: relative;
        overflow: hidden;
        width: auto;
        min-width: 150px;
        touch-action: manipulation;
    }

    .hint-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(251, 194, 235, 0.6);
    }

    .hint-button:active {
        transform: translateY(1px);
    }

    .hint-button:focus-visible {
        outline: 2px solid white;
        outline-offset: 2px;
    }

    /* Time Navigation */
    .time-navigation {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
    }
    
    .time-travel-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 50px;
        padding: 10px 20px;
        color: white;
        font-family: 'Quicksand', sans-serif;
        cursor: pointer;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        transition: all 0.3s ease;
        font-size: clamp(0.8rem, 3vw, 1rem);
        touch-action: manipulation;
    }
    
    .time-travel-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }

    .time-travel-btn:focus-visible {
        outline: 2px solid white;
        outline-offset: 2px;
    }

    /* Animations */
    @keyframes glow {
        0%, 100% { box-shadow: 0 0 15px rgba(255,255,255,0.5); }
        50% { box-shadow: 0 0 30px rgba(255,255,255,1); }
    }

    .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 999;
            animation: confetti-fall 5s linear forwards;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

    @keyframes shoot {
        0% {
            transform: translate(0, 0);
            opacity: 1;
        }
        70% {
            opacity: 1;
        }
        100% {
            transform: translate(var(--end-x), var(--end-y));
            opacity: 0;
        }
    }

    @keyframes float-up {
        0% {
            transform: translateY(0) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(-100vh) rotate(360deg);
            opacity: 0;
        }
    }

    /* Accessibility */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    /* Print Styles */
    @media print {
        body {
            background: white !important;
            color: black !important;
        }
        
        .night-sky, .moon, .time-navigation, .hint-button {
            display: none !important;
        }
        
        .letter-container {
            position: static;
            background: white !important;
            display: block !important;
            opacity: 1 !important;
        }
        
        .letter {
            position: static;
            transform: none !important;
            max-height: none;
            box-shadow: none;
            border: 1px solid #ccc;
            margin: 0 auto;
            color: black;
            width: 100%;
            max-width: 100%;
        }
    }

  
</style>
</head>
<body>
    <div class="night-sky" id="nightSky"></div>
    
    <div class="container">
        <div class="header-content">
            <div class="moon" id="moon" role="button" aria-label="Tap to begin">
                <div class="moon-craters"></div>
            </div>
            <h1>For My Starlight</h1>
            <p class="instructions">Tap the moon to begin our journey</p>
        </div>
        
        <div class="piano-container" id="pianoContainer">
            <h2 class="piano-title">You're A Star</h2>
            <p class="piano-hint">Play "Twinkle Twinkle Little Star" to unlock your message</p>
            <button id="hintButton" class="hint-button" aria-label="Show hint for the song">Show Me How</button>
            
            <div class="song-display" id="songDisplay" aria-live="polite"></div>
            
            <div class="piano">
                <div class="key" data-note="C5" role="button" aria-label="C note">C</div>
                <div class="key black" data-note="C#5" role="button" aria-label="C sharp note">C#</div>
                <div class="key" data-note="D5" role="button" aria-label="D note">D</div>
                <div class="key black" data-note="D#5" role="button" aria-label="D sharp note">D#</div>
                <div class="key" data-note="E5" role="button" aria-label="E note">E</div>
                <div class="key" data-note="F5" role="button" aria-label="F note">F</div>
                <div class="key black" data-note="F#5" role="button" aria-label="F sharp note">F#</div>
                <div class="key" data-note="G5" role="button" aria-label="G note">G</div>
                <div class="key black" data-note="G#5" role="button" aria-label="G sharp note">G#</div>
                <div class="key" data-note="A5" role="button" aria-label="A note">A</div>
                <div class="key black" data-note="A#5" role="button" aria-label="A sharp note">A#</div>
                <div class="key" data-note="B5" role="button" aria-label="B note">B</div>
                <div class="key" data-note="C6" role="button" aria-label="High C note">C</div>
            </div>
            
            <div class="feedback" id="feedback" aria-live="polite"></div>
            <div class="correct-message" id="correctMessage">
                How about that, we may just have a pianist in our midst‚ù§Ô∏èüíØ
            </div>
        </div>
    </div>
    
    <div class="letter-container" id="letterContainer">
        <div class="letter">
           <p><span>My Dearest Snuggles,</span></p>
           <p>Jean Kaycee</p>

<p>As I read your letter, I'm reminded of how <span>special</span> you are, how you bring <span>joy</span> to my life, and how you make me feel <span>seen</span> in ways I could not imagine. Speaking of music that we like, I love the way there‚Äôs a <span>symphony</span> in your laughter, a <span>rhythm</span> in your step, and a <span>harmony</span> in your heart that makes my world complete.</p>
<p>Remember when we <span>reconnected</span>? I am so glad you took the initiative to reach out. I don‚Äôt know if we would be where we are now if it weren‚Äôt for that. That moment was our perfect <span>duet</span> - unplanned, unrehearsed, but absolutely meant to be. You have this incredible ability to turn ordinary days into beautiful <span>compositions</span>, and I find myself collecting these memories like precious songs in a playlist.</p>
<p>The way you always show up with a heart so big, always wanting what‚Äôs <span>best</span> for me and making me feel included. You helping me out with job applications when you don‚Äôt have to. Inviting me to your Ruaka drives with your mom even though I feel like an inconvenience (yes, you‚Äôve told me many times I‚Äôm not). It's just that I‚Äôm not used to people doing good things for me, so it always feels strange, but I couldn‚Äôt <span>appreciate it enough</span>. And thank you for the <span>hair compliments</span>.</p>
<p>I want to be there for you, too. So, here is my promise to you: I will always be your number one <span>fan</span>, your partner in life's <span>unexpected moments</span>, and the person who will tell you every day how <span>amazing</span> you are whenever you forget. Because in this vast <span>universe</span> that we call life, finding someone who is in tune with you is scarcer than any precious <span>metals</span>.</p>

<p>I am just so <span>proud</span> of the person that you are and the person you are becoming. Your <span>heart</span>, your <span>compassion</span>, your <span>courage</span>‚Äîit all shines through you. There is an <span>energy</span> about you that you cannot avoid, and I am grateful to witness the <span>light</span> that you bring to the world.</p>

<p><span>p/s.</span> Even if you wrote on the dirt and took a picture, it would all be the same for me, <span>received with love</span>.</p>

<p>With all the love my heart can hold,</p>
<p><span>Mishy Shimy</span></p>


            <div class="wax-seal" onclick="closeLetter()" role="button" aria-label="Close letter">‚ù§Ô∏è</div>
        </div>
    </div>

    <audio id="hintMelody" preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-twinkle-twinkle-little-star-22.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="time-navigation">
        <button class="time-travel-btn" id="goToPastBtn">Memory Lane</button>
    </div>

    <script>
        // Create stars in the background
        const nightSky = document.getElementById('nightSky');
        for (let i = 0; i < 200; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.width = `${Math.random() * 3 + 1}px`;
            star.style.height = star.style.width;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.setProperty('--duration', `${Math.random() * 8 + 2}s`);
            star.style.setProperty('--delay', `${Math.random() * 5}s`);
            nightSky.appendChild(star);
        }

        // Add realistic craters to the moon
        const moonCraters = document.querySelector('.moon-craters');
        const craterSizes = [15, 12, 10, 8, 6, 5, 4, 3, 2, 2];
        craterSizes.forEach(size => {
            const crater = document.createElement('div');
            crater.classList.add('crater');
            crater.style.width = `${size}px`;
            crater.style.height = `${size}px`;
            crater.style.left = `${Math.random() * 80 + 10}%`;
            crater.style.top = `${Math.random() * 80 + 10}%`;
            moonCraters.appendChild(crater);
        });

        // Moon click event
        const moon = document.getElementById('moon');
        const pianoContainer = document.getElementById('pianoContainer');
        
        moon.addEventListener('click', () => {
            createPortal();
        // Initialize audio context on first interaction
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        moon.style.transform = 'scale(0.8) rotate(360deg)';
        moon.style.opacity = '0.5';
        
        createShootingStar();
        
        setTimeout(() => {
            // Hide moon and header content
            const headerContent = document.querySelector('.header-content');
            headerContent.style.opacity = '0';
            headerContent.style.height = '0';
            headerContent.style.pointerEvents = 'none';
            
            // Show and activate piano container
            pianoContainer.style.display = 'block';
            pianoContainer.classList.add('active');
            
            // Animate piano appearance
            setTimeout(() => {
                pianoContainer.style.opacity = '1';
                spawnMusicNotes();
                pianoContainer.style.transform = 'translateY(0)';
            }, 100);
        }, 1000);
    });

        // Create shooting stars occasionally
        function createShootingStar() {
            const shootingStar = document.createElement('div');
            shootingStar.classList.add('shooting-star');
            
            // Random start position (top edge)
            const startX = Math.random() * window.innerWidth;
            const startY = 0;
            
            // Random end position (somewhere diagonally down)
            const endX = (Math.random() - 0.5) * 300;
            const endY = Math.random() * 300 + 200;
            
            shootingStar.style.left = `${startX}px`;
            shootingStar.style.top = `${startY}px`;
            shootingStar.style.setProperty('--end-x', `${endX}px`);
            shootingStar.style.setProperty('--end-y', `${endY}px`);
            
            document.body.appendChild(shootingStar);
            
            // Animate
            setTimeout(() => {
                shootingStar.style.animation = 'shoot 2s linear forwards';
            }, 10);
            
            // Remove after animation
            setTimeout(() => {
                shootingStar.remove();
            }, 2100);
        }


        // Piano logic using Web Audio API for reliable sound
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const pianoNotes = {
            'C5': 523.25,
            'C#5': 554.37,
            'D5': 587.33,
            'D#5': 622.25,
            'E5': 659.25,
            'F5': 698.46,
            'F#5': 739.99,
            'G5': 783.99,
            'G#5': 830.61,
            'A5': 880.00,
            'A#5': 932.33,
            'B5': 987.77,
            'C6': 1046.50
        };
        
        // Hint button functionality - UPDATED VERSION
    let incorrectAttempts = 0;    
const hintButton = document.getElementById('hintButton');
const hintAudio = new Audio('https://assets.mixkit.co/music/preview/mixkit-twinkle-twinkle-little-star-22.mp3');

hintButton.addEventListener('click', async () => {
    incorrectAttempts = 0; // Reset the counter when hint is used
    hintButton.style.display = 'none'; // Hide the button after use

    try {
        // First phrase
        const firstPhrase = ['C5', 'C5', 'G5', 'G5', 'A5', 'A5', 'G5'];
        // Second phrase with pause before it
        const secondPhrase = ['F5', 'F5', 'E5', 'E5', 'D5', 'D5', 'C5'];
        
        // Ensure audio context is running
        if (audioContext.state === 'suspended') {
            await audioContext.resume();
        }
        
        // Play the audio
        hintAudio.currentTime = 0;
        await hintAudio.play();
        
        // Play first phrase
        for (let i = 0; i < firstPhrase.length; i++) {
            const note = firstPhrase[i];
            const key = document.querySelector(`.key[data-note="${note}"]`);
            
            key.classList.add('active');
            setTimeout(() => key.classList.remove('active'), 500);
            await new Promise(resolve => setTimeout(resolve, 600));
        }
        
        // Add pause between phrases (1200ms = 1.2 second pause)
        await new Promise(resolve => setTimeout(resolve, 1200));
        
        // Play second phrase
        for (let i = 0; i < secondPhrase.length; i++) {
            const note = secondPhrase[i];
            const key = document.querySelector(`.key[data-note="${note}"]`);
            
            key.classList.add('active');
            setTimeout(() => key.classList.remove('active'), 500);
            await new Promise(resolve => setTimeout(resolve, 600));
        }
    } catch (error) {
        console.error('Error playing hint:', error);
        showVisualHintOnly();
    }
});

function showVisualHintOnly() {
    const firstPhrase = ['C5', 'C5', 'G5', 'G5', 'A5', 'A5', 'G5'];
    const secondPhrase = ['F5', 'F5', 'E5', 'E5', 'D5', 'D5', 'C5'];
    let currentPhrase = firstPhrase;
    let i = 0;
    
    const demoInterval = setInterval(() => {
        if (i >= currentPhrase.length) {
            if (currentPhrase === firstPhrase) {
                // Switch to second phrase after pause
                currentPhrase = secondPhrase;
                i = 0;
                setTimeout(() => {}, 1200); // 1.2 second pause
                return;
            } else {
                clearInterval(demoInterval);
                return;
            }
        }
        
        const note = currentPhrase[i];
        const key = document.querySelector(`.key[data-note="${note}"]`);
        
        key.classList.add('active');
        playTone(pianoNotes[note]);
        
        setTimeout(() => {
            key.classList.remove('active');
        }, 500);
        
        i++;
    }, 600);
}

        const keys = document.querySelectorAll('.key');
        const songDisplay = document.getElementById('songDisplay');
        const feedbackElement = document.getElementById('feedback');
        const correctMessage = document.getElementById('correctMessage');
        const letterContainer = document.getElementById('letterContainer');
        
        // Twinkle Twinkle Little Star sequence: C C G G A A G
        const correctSequence = ['C5', 'C5', 'G5', 'G5', 'A5', 'A5', 'G5', 'F5', 'F5', 'E5', 'E5', 'D5', 'D5', 'C5'];
        let currentSequence = [];
        
        function playTone(frequency, duration = 0.5) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;
            
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        keys.forEach(key => {
            key.addEventListener('mousedown', () => playNote(key));
            key.addEventListener('mouseup', () => releaseNote(key));
            key.addEventListener('mouseleave', () => releaseNote(key));
            
            // Add touch support for mobile
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                playNote(key);
            });
            key.addEventListener('touchend', (e) => {
                e.preventDefault();
                releaseNote(key);
            });
        });
        
        function playNote(key) {
    const note = key.dataset.note;
    const frequency = pianoNotes[note];
    
    key.classList.add('active');
    playTone(frequency);
    
    // Add to current sequence
    currentSequence.push(note);
    songDisplay.textContent = currentSequence.map(n => n.replace(/[0-9]/g, '')).join(' ');
    
    // Check if sequence matches
    if (currentSequence.length <= correctSequence.length) {
        if (currentSequence[currentSequence.length - 1] !== correctSequence[currentSequence.length - 1]) {
            // Wrong note played
            incorrectAttempts++;
            
            // Show hint button after 10 incorrect attempts
            if (incorrectAttempts >= 10) {
                hintButton.style.display = 'inline-block';
                // Optional: pulse animation to draw attention
                hintButton.style.animation = 'pulse 1s infinite alternate';
            }
            
            feedbackElement.textContent = "Oops, that's not quite right! Try starting over.";
            feedbackElement.classList.add('show');
            setTimeout(() => {
                feedbackElement.classList.remove('show');
            }, 2000);
            currentSequence = [];
            songDisplay.textContent = '';
        } else if (currentSequence.length === correctSequence.length) {
            // Correct sequence completed!
            incorrectAttempts = 0; // Reset counter on success
            hintButton.style.display = 'none'; // Hide hint button
            feedbackElement.classList.remove('show');
            correctMessage.classList.add('show');
            
            // Create confetti celebration
            
            createConfetti();
            
            // Show letter after delay
            setTimeout(() => {
                pianoContainer.style.opacity = '0';
                pianoContainer.style.transform = 'translateY(50px)';
                
                setTimeout(() => {
                    pianoContainer.style.display = 'none';
                    letterContainer.style.display = 'flex';
                    
                    setTimeout(() => {
                        drawConstellation();
                        letterContainer.classList.add('show');
                    }, 100);
                }, 500);
            }, 2000);
        }
    }
}
        
        function releaseNote(key) {
            key.classList.remove('active');
        }
        
        function createConfetti() {
            const shapes = ['‚ñ†', '‚óè', '‚ñ≤', '‚ô•'];
            const colors = ['#ff9a9e', '#fad0c4', '#fbc2eb', '#a6c1ee', '#84fab0', '#8fd3f4'];
            
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = `${Math.random() * 10 + 5}px`;
                    confetti.style.height = `${Math.random() * 10 + 5}px`;
                    confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                    document.body.appendChild(confetti);
                    
                    // Remove after animation
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 20);
            }
        }

        function createGoldenBurst(x, y) {
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: fixed;
      left: ${x}px;
      top: ${y}px;
        width: ${4 + Math.random() * 4}px;
        height: ${4 + Math.random() * 4}px;
        animation: golden-burst ${0.5 + Math.random() * 1}s ease-out forwards;
      background: radial-gradient(circle, gold 30%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
      z-index: 1000;
    `;
    document.body.appendChild(particle);
    
    // Random trajectory
    const angle = Math.random() * Math.PI * 2;
    const velocity = 3 + Math.random() * 5;
    const rotation = Math.random() * 360;
    
    particle.style.setProperty('--x', `${Math.cos(angle) * velocity}px`);
    particle.style.setProperty('--y', `${Math.sin(angle) * velocity}px`);
    particle.style.setProperty('--r', `${rotation}deg`);
  }
}
let musicNotesInterval;
function spawnMusicNotes() {
            if (!document.querySelector('.piano')) return;
            clearInterval(musicNotesInterval);
            
            const notes = ['‚ô™', '‚ô´', '‚ô©', '‚ô¨'];
            const pianoRect = document.querySelector('.piano').getBoundingClientRect();
            
            musicNotesInterval = setInterval(() => {
                const note = document.createElement('div');
                note.textContent = notes[Math.floor(Math.random() * notes.length)];
                note.classList.add('music-note');
                note.style.cssText = `
                    position: absolute;
                    left: ${pianoRect.left + Math.random() * pianoRect.width}px;
                    bottom: ${pianoRect.bottom}px;
                    font-size: ${20 + Math.random() * 15}px;
                    color: rgba(255,182,193,${0.5 + Math.random() * 0.5});
                    animation: float-up ${3 + Math.random() * 2}s ease-in forwards;
                    z-index: 50;
                    pointer-events: none;
                `;
                document.body.appendChild(note);
                
                setTimeout(() => note.remove(), 5000);
            }, 300);
        }

function inkSplatterTransition() {
  const splatter = document.createElement('div');
  splatter.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M30,50 Q50,20 70,50 T90,50" stroke="%230f0c29" fill="none" stroke-width="10"/></svg>') center/cover;
    opacity: 0;
    animation: splatter-fade 1.5s ease-out;
    z-index: 500;
    pointer-events: none;
  `;
  document.body.appendChild(splatter);
  setTimeout(() => splatter.remove(), 1500);
}

function drawConstellation() {
  const stars = document.querySelectorAll('.star');
  const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  svg.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
  `;
  
  // Draw lines between random stars
  for (let i = 0; i < 15; i++) {
    const star1 = stars[Math.floor(Math.random() * stars.length)];
    const star2 = stars[Math.floor(Math.random() * stars.length)];
    
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", star1.style.left);
    line.setAttribute("y1", star1.style.top);
    line.setAttribute("x2", star2.style.left);
    line.setAttribute("y2", star2.style.top);
    line.setAttribute("stroke", "rgba(255, 255, 255, 0.3)");
    line.setAttribute("stroke-width", "1");
    line.setAttribute("stroke-dasharray", "5,5");
    svg.appendChild(line);
  }
  
  document.body.appendChild(svg);
  setTimeout(() => svg.remove(), 3000);
}

function createPortal() {
  const portal = document.createElement('div');
  portal.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, 
      rgba(248, 237, 148, 0.8) 0%, 
      rgba(36, 36, 62, 0) 70%);
    transform: translate(-50%, -50%);
    z-index: 900;
    animation: portal-expand 1.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    pointer-events: none;
  `;
  document.body.appendChild(portal);
  setTimeout(() => portal.remove(), 1500);
}
        
        function closeLetter() {
            if (letterContainer.classList.contains('closing')) return;
            letterContainer.classList.add('closing');
            letterContainer.classList.remove('show');
            
            const seal = document.querySelector('.wax-seal');
            const rect = seal.getBoundingClientRect();
            createGoldenBurst(rect.left + rect.width/2, rect.top + rect.height/2);

            clearInterval(musicNotesInterval);
            
            // Clean up any remaining notes
            document.querySelectorAll('.music-note').forEach(n => n.remove());
            
            setTimeout(() => {
                letterContainer.style.display = 'none';

                // Hide piano container
                pianoContainer.style.opacity = '0';
                pianoContainer.style.transform = 'translateY(20px)';
                pianoContainer.style.display = 'none';
                pianoContainer.classList.remove('active');
                
                // Reset moon and header to initial state
                moon.style.display = 'block';
                moon.style.opacity = '1';
                moon.style.transform = 'scale(1) rotate(0)';
                
                // Show header content again
                const headerContent = document.querySelector('.header-content');
                headerContent.style.opacity = '1';
                headerContent.style.height = 'auto';
                headerContent.style.pointerEvents = 'auto';
                
                // Reset game state
                correctMessage.classList.remove('show');
                currentSequence = [];
                songDisplay.textContent = '';
                incorrectAttempts = 0;
                hintButton.style.display = 'none';
                document.querySelectorAll('.music-note').forEach(n => n.remove());
                document.querySelectorAll('svg').forEach(svg => svg.remove());
                
                // Create a big celebration
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        createShootingStar();
                    }, i * 100);
                }
            }, 500);
        }

        // Create occasional shooting stars
        setInterval(createShootingStar, 3000);

        // Initialize keyboard navigation for piano keys
        document.addEventListener('DOMContentLoaded', () => {
            const pianoKeys = document.querySelectorAll('.key');
            pianoKeys.forEach((key, index) => {
                key.setAttribute('tabindex', '0');
            });
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (musicNotesInterval) {
                clearInterval(musicNotesInterval);
                spawnMusicNotes();
            }
        });

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            clearInterval(musicNotesInterval);
            if (audioContext) {
                audioContext.close();
            }
        });

        document.getElementById('goToPastBtn').addEventListener('click', () => {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 1s ease';
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        });

        // Add fade-in on load
        document.addEventListener('DOMContentLoaded', () => {
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 1.5s ease';
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
</body>
</html>
